# 快速部署指南

### 1. 环境准备
- 安装 Docker 和 Docker Compose
- 确保端口 8000、5432、6379 可用

### 2. 配置环境变量
创建 `.env` 文件：
```bash
# 必须配置
SECRET_KEY=your_super_secret_jwt_key_here_make_it_long_and_random
ANTHROPIC_API_KEY=sk-ant-api03-xxxxxxxxxxxxxxxxxxxxx

# 数据库配置
DATABASE_URL=postgresql://user:password@db:5432/mydatabase
REDIS_URL=redis://cache:6379

```

### 3. 启动服务
```bash
# 首次部署
docker-compose up --build -d

# 查看状态
docker-compose ps

# 查看日志
docker-compose logs -f server
```

### 4. 前端部署
```bash
cd client

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 或构建生产版本
npm run build
npm run preview
```

### 5. 访问应用
- **前端应用**: http://localhost:5173
- **后端 API**: http://localhost:8000
- **API 文档**: http://localhost:8000/docs

### 6. 代码更新部署
```bash
# 方式1：完全重建（推荐，确保清除缓存）
docker-compose down
docker-compose build --no-cache server
docker-compose up -d

# 方式2：快速重建（适用于简单代码修改）
docker-compose down
docker-compose up --build
```

**何时使用完全重建：**
- 代码修改后服务异常
- 依赖文件变更（requirements.txt）
- 需要清除Python缓存
- 确保使用最新代码

### 7. 常用命令
```bash
# 查看日志
docker-compose logs -f server

# 重启服务
docker-compose restart server

# 停止所有服务
docker-compose down

# 清理系统（谨慎使用）
docker system prune -f
```

### 8. 验证部署
```bash
# 检查 API
curl http://localhost:8000/

# 检查数据库
docker-compose exec db psql -U user -d mydatabase -c "\dt"

docker-compose exec db psql -U user -d mydatabase -c "SELECT * FROM 
messages LIMIT 5;"
```